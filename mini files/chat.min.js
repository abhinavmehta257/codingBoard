let socket=io();window.editors=[];let i=2;function scrollToBottom(){let a=document.querySelector("#messages").lastElementChild;a.scrollIntoView()}function encode(a){return btoa(unescape(encodeURIComponent(a||"")))}function decode(a){var b=escape(atob(a||""));try{return decodeURIComponent(b)}catch{return unescape(b)}}function getDate(){var a=new Date;a.toString();var b=a.getHours(),c=a.getMinutes(),d=a.getSeconds(),e="AM",f=b;12<=f&&(f=b-12,e="PM"),0==f&&(f=12),c=10>c?"0"+c:c,d=10>d?"0"+d:d,f=10>f?"0"+f:f;var g=f+":"+c;return g+=" "+e,g}socket.on("connect",function(){console.log("shocket connected");let a;socket.on("newmember",function(b){a=b,b&&!a.isAdmin&&(a.isAdmin=!1,isAdmin=!1),b&&a.isAdmin&&($.getScript("/js/adminWindow.js",function(){console.log("Admin script loaded")}),roomId=a.roomId),console.log(a),socket.emit("join",a,function(a){a&&(alert(a),window.location.href="/")})}),socket.on("connectionError",function(){alert("connection error occured please reconnect"),window.location.href="/"})}),socket.on("disconnect",function(){alert("disconnected from server."),window.location.href="/"}),socket.on("updateUsersList",function(a){let b=document.createElement("ul");a.forEach(function(a){const c=document.querySelector("#participent-template").innerHTML,d=Mustache.render(c,{User:a});let e=document.createElement("li");e.innerHTML=d,b.appendChild(e)});let c=document.querySelector("#users");c.innerHTML="",c.appendChild(b)}),socket.on("newMessage",function(a){const b=getDate(),c=document.querySelector("#message-template").innerHTML,d=Mustache.render(c,{from:a.from,text:a.text,createdAt:b}),e=document.createElement("div");e.innerHTML=d,document.querySelector("#messages").appendChild(e),scrollToBottom()}),document.querySelector("#submit-btn").addEventListener("click",function(a){a.preventDefault(),socket.emit("createMessage",{text:document.querySelector("input[name=\"message\"]").value},function(){document.querySelector("input[name=\"message\"]").value=""})}),socket.on("youAreNewAdmin",function(a){a?$.getScript("/js/adminWindow.js",function(){console.log("Admin script loaded")}):console.log("wrong person")}),socket.on("giveCode",function(a){var b=a.senderId,c=socket.id;if(activeEditorname=layout.root.contentItems[0].contentItems[0].getActiveContentItem().componentName,activeEditor=editors.filter(a=>a.editorId==activeEditorname),activeEditor[0])var d=encode(activeEditor[0].newEditor.getValue());else var d=encode(sourceEditor.getValue());var e=encode(d);codeData={to:b,from:c,codeString:e},socket.emit("sendCode",codeData)}),socket.on("gotCode",function(a){newCode=a.codeData.codeString,editorId=a.user.id,editors.filter(a=>a.editorId==editorId)[0]&&(editorId=`${editorId}${i}`,i++);var b={title:`${a.user.name}`,type:"component",componentName:`${editorId}`,isClosable:!0,componentState:{readOnly:!1}};layout.registerComponent(`${editorId}`,function(b,c){studentId=a.user.id,b.getElement().html(`<button class="send-btn" style="float:right; padding:2px !important" id="${studentId}" onclick='sendCode(this)'>Send Code<button>`);let d=monaco.editor.create(b.getElement()[0],{automaticLayout:!0,theme:"vs-dark",scrollBeyondLastLine:!0,readOnly:c.readOnly,language:"cpp",minimap:{enabled:!1},rulers:[80,120]});d.setValue(decode(a.codeData.codeString)),editorData={editorId,newEditor:d},editors.push(editorData)}),layout.root.contentItems[0].contentItems[0].addChild(b)});function raiseHand(){socketID=socket.id,socket.emit("raiseHand",socketID)}